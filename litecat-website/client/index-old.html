<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RGBLightCat - The first cat meme token on RGB protocol">
    <title>RGBLightCat - RGB Protocol Token</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- GSAP for smooth animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    
    <!-- QRCode.js for QR generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <style>
        :root {
            --black: #000000;
            --yellow: #FFFF00;
            --dark-gray: #0a0a0a;
            --medium-gray: #1a1a1a;
            --light-gray: #2a2a2a;
            --white: #FFFFFF;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Custom Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--black);
            border: 1px solid rgba(255, 255, 0, 0.2);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--yellow);
            border-radius: 6px;
            border: 2px solid var(--black);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #FFD700;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
        }
        
        /* Firefox Scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--yellow) var(--black);
        }

        body {
            background: var(--black);
            color: var(--white);
            font-family: 'Space Grotesk', -apple-system, sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* Three.js Background Canvas */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
        }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Lightning rain container */
        .lightning-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
            opacity: 0.2;
        }

        /* Content above background */
        .content-wrapper {
            position: relative;
            z-index: 2;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
        }

        /* Header */
        header {
            padding: 40px 0;
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.8);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }

        header.scrolled {
            padding: 20px 0;
            background: rgba(0, 0, 0, 0.95);
            box-shadow: 0 10px 30px rgba(255, 255, 0, 0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .site-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--yellow);
            letter-spacing: 3px;
            text-transform: uppercase;
            margin: 0;
        }

        .tagline {
            font-size: 0.9rem;
            margin-top: 5px;
            font-weight: 500;
            letter-spacing: 1px;
            background: linear-gradient(90deg, 
                #2a2a2a 0%,
                #2a2a2a 40%,
                #666666 48%,
                #FFFF00 50%,
                #FFFF00 52%,
                #666666 54%,
                #2a2a2a 62%,
                #2a2a2a 100%
            );
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: lightning-strike 4s ease-in-out infinite;
        }

        @keyframes lightning-strike {
            0% { background-position: 100% 0; }
            100% { background-position: -100% 0; }
        }

        /* Navigation */
        nav {
            display: flex;
            gap: 40px;
        }

        nav a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: var(--transition);
            position: relative;
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--yellow);
            transition: width 0.3s ease;
        }

        nav a:hover {
            color: var(--yellow);
        }

        nav a:hover::after {
            width: 100%;
        }

        /* Sections */
        section {
            padding: 100px 0;
            position: relative;
        }

        /* Section Titles */
        .section-title {
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 60px;
            text-transform: uppercase;
            letter-spacing: 4px;
            position: relative;
            display: inline-block;
            width: 100%;
            transition: var(--transition);
            cursor: default;
        }

        .section-title:hover {
            color: var(--yellow);
            transform: translateY(-5px);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: var(--yellow);
            transition: width 0.3s ease;
        }

        .section-title:hover::after {
            width: 200px;
        }

        /* Stats Section */
        .stats-section {
            padding-top: 150px;
            background: linear-gradient(180deg, transparent 0%, rgba(255, 255, 0, 0.02) 100%);
        }

        .mint-status-text {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--yellow);
            text-align: center;
            margin-bottom: 30px;
            letter-spacing: 3px;
            text-transform: uppercase;
            opacity: 0;
            transform: translateY(20px);
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 0, 0.2);
            border-radius: 50px;
            padding: 5px;
            margin: 0 auto 60px;
            max-width: 800px;
            overflow: hidden;
        }

        .progress-bar {
            height: 30px;
            background: linear-gradient(90deg, var(--yellow) 0%, #FFD700 100%);
            border-radius: 50px;
            transition: width 1s ease;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 60px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 0, 0.1);
            padding: 40px 20px;
            border-radius: 20px;
            transition: var(--transition);
            text-align: center;
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: translateY(30px);
            overflow: hidden;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .stat-card:hover {
            transform: translateY(-10px);
            border-color: var(--yellow);
            background: rgba(255, 255, 0, 0.05);
            box-shadow: 0 20px 40px rgba(255, 255, 0, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--yellow);
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 10px;
            word-wrap: break-word;
            line-height: 1.2;
            max-width: 100%;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Game Section */
        .game-section {
            position: relative;
            overflow: hidden;
        }

        .tier-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 60px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .tier-card {
            background: rgba(255, 255, 255, 0.02);
            border: 2px solid rgba(255, 255, 0, 0.2);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            opacity: 0;
            transform: translateY(30px) scale(0.9);
        }

        .tier-card:hover {
            transform: translateY(-10px) scale(1);
            border-color: var(--yellow);
            background: rgba(255, 255, 0, 0.1);
            box-shadow: 0 20px 40px rgba(255, 255, 0, 0.2);
        }

        .tier-card.unlocked {
            border-color: var(--yellow);
            background: rgba(255, 255, 0, 0.05);
        }

        .tier-number {
            font-size: 3rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.3);
            margin-bottom: 10px;
        }

        .tier-card.unlocked .tier-number {
            color: var(--yellow);
        }

        .tier-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Buttons */
        .btn {
            background: transparent;
            color: var(--yellow);
            border: 2px solid var(--yellow);
            padding: 15px 40px;
            font-weight: 600;
            font-size: 0.95rem;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--yellow);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .btn:hover {
            color: var(--black);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 255, 0, 0.3);
        }

        .btn:hover::before {
            left: 0;
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Game Canvas */
        .game-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border: 1px solid rgba(255, 255, 0, 0.3);
            border-radius: 10px;
            background: var(--black);
        }

        /* Purchase Section */
        .purchase-section {
            background: linear-gradient(180deg, transparent 0%, rgba(255, 255, 0, 0.02) 100%);
        }

        .purchase-form {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.02);
            padding: 50px;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 0, 0.2);
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: translateY(30px);
        }

        .form-input {
            width: 100%;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 0, 0.2);
            border-radius: 15px;
            color: var(--white);
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--yellow);
            background: rgba(255, 255, 0, 0.05);
        }

        /* Batch Selector */
        .batch-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }

        .batch-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 0, 0.3);
            background: transparent;
            color: var(--yellow);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .batch-btn:hover:not(:disabled) {
            border-color: var(--yellow);
            background: rgba(255, 255, 0, 0.1);
            transform: scale(1.1);
        }

        .batch-count {
            font-size: 3rem;
            font-weight: 700;
            min-width: 100px;
            text-align: center;
            color: var(--yellow);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--medium-gray);
            border: 2px solid rgba(255, 255, 0, 0.3);
            border-radius: 30px;
            padding: 50px;
            max-width: 500px;
            width: 90%;
            position: relative;
            transform: scale(0.9);
            opacity: 0;
            animation: modalAppear 0.3s ease forwards;
        }

        @keyframes modalAppear {
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Footer */
        footer {
            padding: 60px 0;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 0, 0.1);
        }

        /* Animations */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeIn 0.8s ease forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Game specific styles */
        #gameWrapper {
            box-shadow: 0 0 30px rgba(255, 255, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        #gameWrapper:hover {
            box-shadow: 0 0 40px rgba(255, 255, 0, 0.3);
        }
        
        #startGameBtn {
            box-shadow: 0 5px 20px rgba(255, 255, 0, 0.3);
        }
        
        #startGameBtn:hover {
            box-shadow: 0 10px 30px rgba(255, 255, 0, 0.5);
        }

        /* Payment Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: var(--dark-gray);
            border: 2px solid var(--yellow);
            border-radius: 30px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 95vh;
            overflow: hidden;
            position: relative;
            box-shadow: 0 20px 60px rgba(255, 255, 0, 0.2);
            display: flex;
            flex-direction: column;
        }
        
        .payment-info {
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
            padding-right: 5px;
        }
        
        /* Hide scrollbar but keep functionality */
        .payment-info::-webkit-scrollbar {
            width: 0;
            display: none;
        }
        
        .payment-info {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .payment-qr {
            text-align: center;
            margin: 15px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }
        
        #qrcode {
            display: block;
            padding: 0;
            background: transparent;
            border: none;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            width: fit-content;
        }
        
        #qrcode img,
        #qrcode canvas {
            display: block !important;
            margin: 0 auto !important;
            border: none !important;
            padding: 0 !important;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        /* Ensure only first QR code element is visible */
        #qrcode > *:not(:first-child) {
            display: none !important;
        }
        
        /* Responsive - Small phones like iPhone SE */
        @media (max-width: 375px) {
            .container {
                padding: 0 15px;
            }
            
            .site-title {
                font-size: 1.5rem !important;
            }
            
            .logo {
                width: 40px !important;
                height: 40px !important;
            }
            
            .section-title {
                font-size: 1.5rem !important;
                letter-spacing: 1px !important;
            }
            
            /* Purchase form optimization */
            .purchase-form {
                padding: 20px !important;
            }
            
            .form-input {
                padding: 12px !important;
                font-size: 0.875rem !important;
            }
            
            .batch-selector {
                gap: 15px !important;
            }
            
            .batch-btn {
                width: 35px !important;
                height: 35px !important;
                font-size: 1.2rem !important;
            }
            
            .batch-count {
                font-size: 2rem !important;
            }
            
            /* Modal optimization */
            .modal-content {
                padding: 15px 10px !important;
                margin: 5px !important;
                width: calc(100% - 10px) !important;
                max-height: calc(100vh - 10px) !important;
            }
            
            .modal-content h3 {
                font-size: 1rem !important;
                margin-bottom: 10px !important;
                letter-spacing: 1px !important;
            }
            
            .payment-info > div {
                margin: 10px 0 !important;
                padding: 12px 8px !important;
                border-radius: 12px !important;
            }
            
            #paymentAmount {
                font-size: 0.9rem !important;
                padding: 8px !important;
            }
            
            #paymentAddress {
                font-size: 0.6rem !important;
                padding: 8px 6px !important;
                line-height: 1.4 !important;
            }
            
            .payment-info button {
                padding: 5px 10px !important;
                font-size: 0.65rem !important;
            }
            
            .payment-info > div:last-of-type {
                font-size: 0.7rem !important;
                padding: 10px !important;
                letter-spacing: 0 !important;
            }
            
            .payment-info > div:last-of-type span {
                font-size: 0.65rem !important;
            }
            
            #closeModal {
                top: 5px !important;
                right: 5px !important;
                font-size: 1rem !important;
                width: 25px !important;
                height: 25px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .modal-content h3 {
                font-size: 1.2rem !important;
            }
            
            #paymentAmount {
                font-size: 0.9rem !important;
                padding: 10px !important;
            }
            
            #paymentAddress {
                font-size: 0.75rem !important;
                padding: 10px !important;
            }
            
            /* Stats optimization */
            .stat-number {
                font-size: 1.8rem !important;
            }
            
            .stat-card {
                padding: 25px 15px !important;
                min-height: 150px;
            }
            
            .stat-label {
                font-size: 0.75rem !important;
            }
            
            .mint-status-text {
                font-size: 1.5rem !important;
            }
            
            /* Tier cards */
            .tier-card {
                padding: 20px !important;
            }
            
            .tier-card h3 {
                font-size: 1.2rem !important;
            }
            
            /* Game specific */
            #gameWrapper {
                height: 350px !important;
            }
            
            #gameStartScreen img {
                width: 50px !important;
                height: 50px !important;
            }
            
            #gameStartScreen h3 {
                font-size: 1rem !important;
            }
            
            #gameStartScreen p {
                font-size: 0.75rem !important;
            }
            
            #startGameBtn {
                font-size: 0.8rem !important;
                padding: 10px 25px !important;
            }
            
            /* Bitcoin amount display */
            #totalBTC {
                font-size: 1.8rem !important;
            }
            
            /* Footer */
            footer {
                padding: 30px 0 !important;
                font-size: 0.8rem !important;
            }
        }
        
        /* Responsive - Tablets and medium phones */
        @media (max-width: 768px) {
            .tier-grid {
                grid-template-columns: 1fr;
            }
            
            nav {
                display: none;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            #gameWrapper {
                height: 400px !important;
            }
            
            /* Game start screen mobile optimization */
            #gameStartScreen {
                padding: 20px !important;
            }
            
            #gameStartScreen img {
                width: 60px !important;
                height: 60px !important;
                margin-bottom: 10px !important;
            }
            
            #gameStartScreen h3 {
                font-size: 1.2rem !important;
                letter-spacing: 2px !important;
            }
            
            #gameStartScreen p {
                font-size: 0.8rem !important;
                padding: 0 10px;
                margin: 0 0 20px 0 !important;
                line-height: 1.3 !important;
            }
            
            #startGameBtn {
                font-size: 0.9rem !important;
                padding: 12px 30px !important;
                margin-bottom: 20px !important;
            }
            
            /* Hide keyboard controls on mobile */
            #gameStartScreen > div:last-child {
                display: none !important;
            }
            
            /* Additional mobile optimizations */
            .header-content {
                flex-direction: column;
                text-align: center;
                padding: 20px 15px !important;
            }
            
            .logo-section {
                margin-bottom: 20px;
                flex-direction: column;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            /* Fix % sold visibility on mobile */
            .mint-status-text {
                font-size: 1.4rem !important;
                margin-bottom: 20px !important;
            }
            
            .stats-section {
                padding-top: 120px !important;
            }
            
            .stat-card {
                padding: 30px 20px !important;
                min-height: 160px;
            }
            
            .stat-number {
                font-size: 2rem !important;
            }
            
            .stat-label {
                font-size: 0.8rem !important;
            }
            
            .purchase-form {
                padding: 30px 20px !important;
                border-radius: 20px;
            }
            
            .form-label {
                font-size: 0.875rem !important;
            }
            
            .btn {
                padding: 12px 30px !important;
                font-size: 0.9rem !important;
            }
            
            /* Payment modal */
            .modal-content {
                width: 95% !important;
                max-width: none !important;
                margin: 10px !important;
                padding: 30px 15px !important;
                max-height: 95vh !important;
            }
            
            .modal-content h3 {
                font-size: 1.4rem !important;
                margin-bottom: 20px !important;
            }
            
            .payment-info > div {
                margin: 20px 0 !important;
                padding: 20px 15px !important;
            }
            
            #paymentAmount {
                font-size: 1.2rem !important;
                padding: 12px !important;
            }
            
            #paymentAddress {
                font-size: 0.75rem !important;
                padding: 12px !important;
                line-height: 1.6 !important;
            }
            
            .payment-info button {
                padding: 8px 15px !important;
                font-size: 0.8rem !important;
            }
            
            #closeModal {
                top: 10px !important;
                right: 10px !important;
                font-size: 1.5rem !important;
            }
            
            /* Navigation */
            nav {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Three.js Canvas -->
    <canvas id="three-canvas"></canvas>
    
    <!-- Lightning Rain Background -->
    <div class="lightning-rain" id="lightningRain"></div>
    
    <div class="content-wrapper">
        <header id="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo-section">
                        <img src="logo.jpg" alt="RGBLightCat Logo" class="logo">
                        <div>
                            <h1 class="site-title">LIGHTCAT</h1>
                            <p class="tagline">First Cat Meme Token on RGB Protocol</p>
                        </div>
                    </div>
                    <nav>
                        <a href="#stats">Stats</a>
                        <a href="#game">Game</a>
                        <a href="#purchase">Purchase</a>
                        <a href="tokenomics.html">Tokenomics</a>
                        <a href="https://twitter.com/RGBLightCat" target="_blank" rel="noopener noreferrer" style="display: inline-flex; align-items: center; gap: 5px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="var(--yellow)" style="vertical-align: middle;">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                    </nav>
                </div>
            </div>
        </header>

        <section id="stats" class="stats-section">
            <div class="container">
                <h2 class="section-title">LIVE MINT STATUS</h2>
                <div class="mint-status-text" id="progressText">7.00% SOLD</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar" style="width: 7%; background: var(--yellow);"></div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="soldBatches">2,100</div>
                        <div class="stat-label">Batches Sold</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="remainingBatches">27,900</div>
                        <div class="stat-label">Remaining</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalTokens">1,470,000</div>
                        <div class="stat-label">Tokens Sold</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="uniqueBuyers">0</div>
                        <div class="stat-label">Unique Wallets</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="game" class="game-section">
            <div class="container">
                <h2 class="section-title">UNLOCK PURCHASE TIERS</h2>
                
                <div class="tier-grid">
                    <div class="tier-card" id="tier3">
                        <div class="tier-number">1</div>
                        <div class="tier-name">Gold</div>
                        <div class="tier-requirement">Score: 28+ ⚡</div>
                        <div class="tier-reward">Max: 10 Batches</div>
                    </div>
                    <div class="tier-card" id="tier2">
                        <div class="tier-number">2</div>
                        <div class="tier-name">Silver</div>
                        <div class="tier-requirement">Score: 18-27 ⚡</div>
                        <div class="tier-reward">Max: 8 Batches</div>
                    </div>
                    <div class="tier-card" id="tier1">
                        <div class="tier-number">3</div>
                        <div class="tier-name">Bronze</div>
                        <div class="tier-requirement">Score: 11-17 ⚡</div>
                        <div class="tier-reward">Max: 5 Batches</div>
                    </div>
                </div>

                <div class="game-container" style="position: relative;">
                    <div id="gameWrapper" style="position: relative; width: 100%; height: 500px; background: #000; border-radius: 20px; overflow: visible; border: 2px solid rgba(255, 255, 0, 0.3);">
                        <iframe id="gameFrame" src="" style="width: 100%; height: 100%; border: none; display: none; border-radius: 20px;" tabindex="0"></iframe>
                        <div id="clickToFocus" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.95); border: 1px solid var(--yellow); padding: 10px 20px; border-radius: 20px; display: none; pointer-events: none; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.5);">
                            <p style="color: var(--yellow); font-weight: 600; text-transform: uppercase; margin: 0; font-size: 0.8rem; letter-spacing: 1px;">Click to activate game controls</p>
                        </div>
                        <div id="gameStartScreen" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #000; z-index: 10; padding: 40px; border-radius: 20px;">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <img src="images/RGB_LITE_CAT_LOGO.jpg" alt="" style="width: 120px; height: 120px; margin-bottom: 15px;">
                                <h3 style="color: var(--yellow); font-size: 1.8rem; margin: 0; text-transform: uppercase; letter-spacing: 4px; font-weight: 700;">LIGHT CAT</h3>
                            </div>
                            <p style="color: rgba(255,255,255,0.7); margin: 0 0 30px 0; text-align: center; max-width: 400px; font-size: 0.95rem; line-height: 1.4;">Control the cat and collect lightning bolts in 30 seconds to unlock exclusive purchase tiers!</p>
                            <button class="btn" id="startGameBtn" style="font-size: 1rem; padding: 18px 50px; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; line-height: 1;">
                                START GAME
                            </button>
                            <div style="width: 100%; max-width: 500px; margin-top: auto;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center; color: rgba(255,255,255,0.6); font-size: 0.85rem;">
                                    <div><span style="color: var(--yellow); font-weight: 600;">W/↑</span> Move Forward</div>
                                    <div><span style="color: var(--yellow); font-weight: 600;">S/↓</span> Move Backward</div>
                                    <div><span style="color: var(--yellow); font-weight: 600;">A/←</span> Move Left</div>
                                    <div><span style="color: var(--yellow); font-weight: 600;">D/→</span> Move Right</div>
                                    <div><span style="color: var(--yellow); font-weight: 600;">SPACE</span> Jump</div>
                                    <div><span style="color: var(--yellow); font-weight: 600;">SHIFT</span> Sprint</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" id="fullscreenBtn" style="display: none; padding: 12px 35px; font-size: 0.9rem;">
                            <span id="fullscreenText">⛶ FULLSCREEN</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="purchase" class="purchase-section">
            <div class="container">
                <h2 class="section-title">PURCHASE TOKENS</h2>
                
                <!-- RGB Protocol Info -->
                <div style="max-width: 800px; margin: 0 auto 40px; text-align: center;">
                    <p style="color: rgba(255, 255, 255, 0.8); font-size: 1rem; line-height: 1.6; margin-bottom: 20px;">
                        LIGHTCAT uses the RGB Protocol - a revolutionary Bitcoin Layer 2 technology that enables smart contracts 
                        and token issuance with client-side validation. Your tokens are secured by Bitcoin's network.
                        We recommend using <strong style="color: var(--yellow);">Bitcoin Tribe wallet</strong> for the best RGB experience.
                    </p>
                    
                    <!-- Purchase Flow -->
                    <div style="margin: 30px 0; padding: 20px; background: rgba(255, 255, 0, 0.05); border: 1px solid rgba(255, 255, 0, 0.2); border-radius: 10px;">
                        <p style="color: var(--yellow); font-weight: 600; margin-bottom: 15px;">Purchase Flow:</p>
                        <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 50px; background: var(--yellow); color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin: 0 auto 5px;">1</div>
                                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Enter RGB Invoice</p>
                            </div>
                            <span style="color: var(--yellow); font-size: 1.5rem;">→</span>
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 50px; background: var(--yellow); color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin: 0 auto 5px;">2</div>
                                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Get Lightning Invoice</p>
                            </div>
                            <span style="color: var(--yellow); font-size: 1.5rem;">→</span>
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 50px; background: var(--yellow); color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin: 0 auto 5px;">3</div>
                                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Pay with Lightning</p>
                            </div>
                            <span style="color: var(--yellow); font-size: 1.5rem;">→</span>
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 50px; background: var(--yellow); color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin: 0 auto 5px;">4</div>
                                <p style="font-size: 0.8rem; color: rgba(255,255,255,0.8);">Receive Tokens</p>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
                        <div style="padding: 15px 25px; background: rgba(255, 255, 0, 0.1); border: 1px solid rgba(255, 255, 0, 0.3); border-radius: 10px;">
                            <strong style="color: var(--yellow);">Self-Custody</strong>
                            <p style="margin: 5px 0 0; font-size: 0.85rem; color: rgba(255,255,255,0.7);">You control your tokens</p>
                        </div>
                        <div style="padding: 15px 25px; background: rgba(255, 255, 0, 0.1); border: 1px solid rgba(255, 255, 0, 0.3); border-radius: 10px;">
                            <strong style="color: var(--yellow);">Lightning Fast</strong>
                            <p style="margin: 5px 0 0; font-size: 0.85rem; color: rgba(255,255,255,0.7);">Instant payments via LN</p>
                        </div>
                        <div style="padding: 15px 25px; background: rgba(255, 255, 0, 0.1); border: 1px solid rgba(255, 255, 0, 0.3); border-radius: 10px;">
                            <strong style="color: var(--yellow);">Bitcoin Secured</strong>
                            <p style="margin: 5px 0 0; font-size: 0.85rem; color: rgba(255,255,255,0.7);">Protected by Bitcoin</p>
                        </div>
                    </div>
                </div>
                
                <form class="purchase-form" id="purchaseForm">
                    <div class="form-group">
                        <label class="form-label" style="display: block; margin-bottom: 15px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">RGB Invoice</label>
                        <div style="position: relative;">
                            <input 
                                type="text" 
                                class="form-input" 
                                id="rgbInvoice" 
                                placeholder="rgb:utxob:WiUyMWVkN..."
                                required
                                style="padding-right: 50px;"
                            >
                            <button type="button" id="scanQRBtn" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: var(--yellow); color: #000; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; font-weight: 600;">
                                SCAN
                            </button>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: rgba(255, 255, 0, 0.05); border: 1px solid rgba(255, 255, 0, 0.2); border-radius: 10px;">
                            <p style="color: var(--yellow); font-weight: 600; margin-bottom: 10px; font-size: 0.9rem;">
                                How to get your RGB Invoice:
                            </p>
                            <ol style="color: rgba(255, 255, 255, 0.8); font-size: 0.85rem; margin: 0; padding-left: 20px; line-height: 1.8;">
                                <li>Download Bitcoin Tribe wallet (recommended RGB wallet)</li>
                                <li>Open the app and navigate to "Receive" or "RGB Assets"</li>
                                <li>Select "Create RGB Invoice" or "Receive RGB20 Tokens"</li>
                                <li>Copy the generated invoice (starts with "rgb:") or scan QR code</li>
                                <li>Paste it here and click "CREATE LIGHTNING INVOICE"</li>
                                <li>Pay the Lightning invoice to receive your LIGHTCAT tokens</li>
                            </ol>
                            <div style="margin-top: 12px; padding: 10px; background: rgba(255, 255, 0, 0.1); border: 1px solid rgba(255, 255, 0, 0.3); border-radius: 8px;">
                                <p style="margin: 0; color: var(--yellow); font-weight: 600; font-size: 0.85rem;">
                                    Recommended RGB Wallet:
                                </p>
                                <p style="margin: 5px 0; font-size: 0.8rem;">
                                    <strong style="color: #fff;">Bitcoin Tribe RGB</strong> - Full RGB protocol support with Lightning integration
                                </p>
                                <div style="margin-top: 8px;">
                                    <a href="https://bitcointribe.app/" target="_blank" style="color: var(--yellow); text-decoration: underline; font-size: 0.8rem; margin-right: 15px;">Download Bitcoin Tribe</a>
                                    <a href="https://play.google.com/store/apps/details?id=com.bithyve.tribe" target="_blank" style="color: var(--yellow); text-decoration: underline; font-size: 0.8rem;">Google Play</a>
                                </div>
                            </div>
                            <p style="margin-top: 10px; color: rgba(255, 255, 255, 0.6); font-size: 0.75rem;">
                                Other RGB wallets: Iris, MyCitadel, BitMask • More info: <a href="https://rgb.tech/wallets" target="_blank" style="color: var(--yellow); text-decoration: underline;">rgb.tech/wallets</a>
                            </p>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 30px;">
                        <label class="form-label" style="display: block; margin-bottom: 15px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Email (Optional)</label>
                        <input 
                            type="email" 
                            class="form-input" 
                            id="emailAddress" 
                            placeholder="your@email.com"
                        >
                        <p style="margin-top: 10px; color: rgba(255, 255, 255, 0.6); font-size: 0.85rem;">
                            Receive download link for your consignment
                        </p>
                    </div>
                    
                    <div class="form-group" style="margin-top: 40px;">
                        <label class="form-label" style="display: block; margin-bottom: 15px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Number of Batches</label>
                        <div class="batch-selector">
                            <button type="button" class="batch-btn" id="decreaseBatch">−</button>
                            <div class="batch-count" id="batchCount">1</div>
                            <button type="button" class="batch-btn" id="increaseBatch">+</button>
                        </div>
                        <p style="text-align: center; color: rgba(255, 255, 255, 0.6); margin-top: 20px;">
                            Maximum allowed: <span id="maxBatches" style="color: var(--yellow);">5</span> batches
                        </p>
                    </div>
                    
                    <div style="background: rgba(255, 255, 0, 0.05); border: 1px solid rgba(255, 255, 0, 0.2); border-radius: 15px; padding: 30px; margin: 40px 0; text-align: center;">
                        <div style="font-size: 2.5rem; font-weight: 700; color: var(--yellow); font-family: 'JetBrains Mono', monospace;" id="totalBTC">0.00002000 BTC</div>
                        <div style="margin-top: 10px; color: rgba(255, 255, 255, 0.7);">
                            <span id="totalSats">2,000</span> satoshis • 
                            <span id="tokenAmount">700</span> LIGHTCAT tokens
                        </div>
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%; font-size: 1.1rem;">
                        CREATE LIGHTNING INVOICE
                    </button>
                </form>
            </div>
        </section>

        <footer>
            <div class="container">
                <p>© 2025 RGBLightCat Token. Built on RGB Protocol.</p>
            </div>
        </footer>
    </div>

    <!-- QR Scanner Modal -->
    <div class="modal" id="qrScannerModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px; text-align: center; position: relative;">
            <button class="modal-close" id="closeQRScanner" style="position: absolute; top: 20px; right: 20px; background: none; border: none; color: var(--yellow); font-size: 2rem; cursor: pointer; z-index: 10;">&times;</button>
            <h2 style="color: var(--yellow); margin-bottom: 20px;">Scan RGB Invoice QR Code</h2>
            
            <!-- Scanner State Container -->
            <div id="scannerStateContainer" style="min-height: 300px;">
                <!-- Initial state - asking for camera permission -->
                <div id="cameraPermissionDiv" style="padding: 40px;">
                    <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: var(--yellow); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="#000">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <h3 style="color: var(--yellow); margin-bottom: 15px;">Camera Permission Required</h3>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px;">
                        To scan QR codes, we need access to your camera
                    </p>
                    <button id="startScannerBtn" style="background: var(--yellow); color: #000; border: none; padding: 12px 30px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem;">
                        Enable Camera & Scan
                    </button>
                </div>
                
                <!-- QR Scanner Container (hidden initially) -->
                <div id="qrReaderDiv" style="width: 100%; max-width: 400px; margin: 0 auto; display: none; position: relative; min-height: 300px;">
                    <!-- Scanner will be initialized here -->
                </div>
                
                <!-- Success State (hidden initially) -->
                <div id="scanSuccessDiv" style="display: none; padding: 40px;">
                    <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: #4CAF50; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="#fff">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                    </div>
                    <h3 style="color: #4CAF50; margin-bottom: 15px;">QR Code Scanned!</h3>
                    <p style="color: rgba(255,255,255,0.8); word-break: break-all; font-family: monospace; font-size: 0.9rem; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px;" id="scannedInvoice"></p>
                </div>
            </div>
            
            <p style="color: rgba(255,255,255,0.6); margin-top: 20px; font-size: 0.85rem;">
                Position your wallet's QR code within the camera frame
            </p>
            
            <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,0,0.05); border: 1px solid rgba(255,255,0,0.2); border-radius: 8px;">
                <p style="color: var(--yellow); font-weight: 600; margin-bottom: 5px;">Having trouble?</p>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-bottom: 10px;">
                    Make sure your wallet is showing an RGB invoice QR code (not a Bitcoin address)
                </p>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button id="uploadQRBtn" style="background: transparent; color: var(--yellow); border: 1px solid var(--yellow); padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                        Upload QR Image
                    </button>
                    <button id="manualInputBtn" style="background: transparent; color: var(--yellow); border: 1px solid var(--yellow); padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">
                        Enter Manually
                    </button>
                </div>
                <input type="file" id="qrFileInput" accept="image/*" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <button style="position: absolute; top: 20px; right: 20px; background: none; border: none; color: var(--yellow); font-size: 2rem; cursor: pointer;" id="closeModal">&times;</button>
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--yellow); font-size: 1.5rem; text-transform: uppercase; letter-spacing: 2px;">Lightning Payment</h3>
            
            <div class="payment-info" style="text-align: center; width: 100%;">
                <div class="payment-qr" id="qrCodeContainer" style="width: 100%; display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
                    <div style="background: #000; padding: 15px; border-radius: 10px; border: 2px solid var(--yellow);">
                        <div id="qrcode" style="margin: 0 auto;"></div>
                    </div>
                </div>
                
                <div style="background: rgba(255, 255, 0, 0.05); border: 2px solid rgba(255, 255, 0, 0.3); border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <p style="margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--yellow); font-weight: 600; font-size: 0.9rem;">Amount to pay:</p>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; color: var(--yellow); margin: 10px 0; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 1px solid var(--yellow); border-radius: 12px;">
                        <span id="paymentAmount">0.00002000 BTC</span><br>
                        <span style="font-size: 0.9rem; opacity: 0.8;">(<span id="paymentSats">2,000</span> sats)</span>
                    </div>
                    
                    <p style="margin-bottom: 10px; margin-top: 20px; text-transform: uppercase; letter-spacing: 1px; color: var(--yellow); font-weight: 600; font-size: 0.9rem;">Lightning Invoice:</p>
                    <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; word-break: break-all; margin: 10px 0; padding: 12px; background: rgba(0, 0, 0, 0.8); border: 1px solid var(--yellow); border-radius: 12px; cursor: pointer; transition: all 0.3s; line-height: 1.4; max-height: 100px; overflow-y: auto;" id="lightningInvoice" onclick="copyInvoice()">
                        Loading...
                    </div>
                    
                    <div style="display: flex; gap: 8px; justify-content: center; margin-top: 15px; flex-wrap: wrap;">
                        <button onclick="copyInvoice()" style="background: transparent; border: 1px solid var(--yellow); color: var(--yellow); padding: 8px 20px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; transition: all 0.3s;" onmouseover="this.style.background='var(--yellow)'; this.style.color='var(--black)'" onmouseout="this.style.background='transparent'; this.style.color='var(--yellow)'">Copy Invoice</button>
                    </div>
                </div>
                
                <div style="border: 2px solid var(--yellow); background: rgba(255, 255, 0, 0.02); padding: 15px; text-align: center; text-transform: uppercase; letter-spacing: 1px; border-radius: 12px; font-weight: 600; font-size: 0.85rem;">
                    ⚡ Pay with Lightning Network ⚡<br>
                    <span style="font-size: 0.75rem; opacity: 0.8; text-transform: none; letter-spacing: normal;">Invoice expires in 30 minutes</span>
                </div>
                
                <p style="text-align: center; margin-top: 20px; margin-bottom: 10px; color: rgba(255, 255, 255, 0.7); font-size: 0.85rem;">
                    <span style="display: inline-block; animation: pulse 2s infinite;">⚡</span> <span id="paymentStatus">Waiting for payment...</span>
                </p>
                
                <div id="consignmentReady" style="display: none; margin-top: 20px; padding: 20px; background: rgba(0, 255, 0, 0.1); border: 2px solid #00FF00; border-radius: 10px;">
                    <h4 style="color: #00FF00; margin-bottom: 10px;">Payment Confirmed!</h4>
                    <p style="margin-bottom: 15px;">Your RGB consignment is ready.</p>
                    <button onclick="downloadConsignment()" class="btn" style="background: #00FF00; color: #000;">Download Consignment</button>
                </div>
            </div>
        </div>
    </div>


    <script src="litecat-game.js"></script>
    <script>
        // Initialize GSAP
        gsap.registerPlugin(ScrollTrigger);

        // Three.js Background
        let scene, camera, renderer, particles;

        function initThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('three-canvas'),
                alpha: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.position.z = 5;

            // Create particles
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const sparkle = 500;

            for (let i = 0; i < sparkle; i++) {
                const x = Math.random() * 2000 - 1000;
                const y = Math.random() * 2000 - 1000;
                const z = Math.random() * 2000 - 1000;
                vertices.push(x, y, z);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));

            const material = new THREE.PointsMaterial({ 
                color: 0xFFFF00, 
                size: 2,
                transparent: true,
                opacity: 0.8
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            particles.rotation.x += 0.0005;
            particles.rotation.y += 0.0005;
            renderer.render(scene, camera);
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initThree();
            initAnimations();
            createLightningRain();
        });

        // Window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Header scroll effect
        window.addEventListener('scroll', () => {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // GSAP Animations
        function initAnimations() {
            // Fade in elements
            gsap.to('.mint-status-text', {
                opacity: 1,
                y: 0,
                duration: 1,
                delay: 0.5
            });

            // Stat cards
            gsap.to('.stat-card', {
                opacity: 1,
                y: 0,
                duration: 0.8,
                stagger: 0.1,
                delay: 0.8
            });

            // Tier cards
            ScrollTrigger.create({
                trigger: '.tier-grid',
                start: 'top 80%',
                onEnter: () => {
                    gsap.to('.tier-card', {
                        opacity: 1,
                        y: 0,
                        scale: 1,
                        duration: 0.8,
                        stagger: 0.15
                    });
                }
            });

            // Purchase form
            ScrollTrigger.create({
                trigger: '.purchase-form',
                start: 'top 80%',
                onEnter: () => {
                    gsap.to('.purchase-form', {
                        opacity: 1,
                        y: 0,
                        duration: 1
                    });
                }
            });
        }

        // Create dynamic lightning rain
        function createLightningRain() {
            const container = document.getElementById('lightningRain');
            
            for (let i = 0; i < 15; i++) {
                const bolt = document.createElement('div');
                bolt.style.position = 'absolute';
                bolt.style.left = Math.random() * 100 + '%';
                bolt.style.top = '-100px';
                bolt.style.width = '40px';
                bolt.style.height = '60px';
                bolt.style.backgroundImage = 'url(LIGHTING_BOT.png)';
                bolt.style.backgroundSize = 'contain';
                bolt.style.backgroundRepeat = 'no-repeat';
                bolt.style.opacity = Math.random() * 0.3 + 0.1;
                bolt.style.animation = `fall ${Math.random() * 3 + 4}s linear infinite`;
                bolt.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(bolt);
            }
        }

        // Add CSS animation for lightning
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fall {
                to {
                    transform: translateY(calc(100vh + 100px));
                }
            }
        `;
        document.head.appendChild(style);

        // QR Code generation for Lightning
        function generateLightningQR(lightningInvoice) {
            const qrContainer = document.getElementById('qrcode');
            // Clear any existing QR codes
            while (qrContainer.firstChild) {
                qrContainer.removeChild(qrContainer.firstChild);
            }
            
            // Calculate optimal QR code size based on viewport
            const viewportWidth = window.innerWidth;
            const qrSize = viewportWidth <= 375 ? 160 : 
                           viewportWidth <= 768 ? 180 : 
                           200;
            
            // Create QR code
            try {
                new QRCode(qrContainer, {
                    text: lightningInvoice,
                    width: qrSize,
                    height: qrSize,
                    colorDark: "#000000",
                    colorLight: "#FFFFFF",
                    correctLevel: QRCode.CorrectLevel.L
                });
            } catch (error) {
                console.error('QR Code generation error:', error);
                qrContainer.innerHTML = `<p style="color: var(--yellow); padding: 20px;">QR Code generation failed. Please copy the invoice manually.</p>`;
            }
        }

        // Payment modal functions
        window.showPaymentModal = function(invoice) {
            const modal = document.getElementById('paymentModal');
            
            // Update modal content
            document.getElementById('paymentAmount').textContent = invoice.amountBTC.toFixed(8) + ' BTC';
            document.getElementById('paymentSats').textContent = invoice.amountSats.toLocaleString();
            document.getElementById('lightningInvoice').textContent = invoice.lightningInvoice;
            
            // Reset consignment section
            document.getElementById('consignmentReady').style.display = 'none';
            document.getElementById('paymentStatus').textContent = 'Waiting for payment...';
            
            // Generate QR code for Lightning invoice
            generateLightningQR(invoice.lightningInvoice);
            
            // Show modal
            modal.style.display = 'flex';
        };


        // Notification system
        function showNotification(message) {
            const notif = document.createElement('div');
            notif.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--yellow);
                color: var(--black);
                padding: 15px 30px;
                border-radius: 50px;
                font-weight: 600;
                z-index: 3000;
                animation: slideIn 0.3s ease;
            `;
            notif.textContent = message;
            document.body.appendChild(notif);
            
            setTimeout(() => {
                notif.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        // Add notification animations
        const notifStyle = document.createElement('style');
        notifStyle.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            @keyframes pulse {
                0% { opacity: 1; transform: scale(1); }
                50% { opacity: 0.5; transform: scale(1.1); }
                100% { opacity: 1; transform: scale(1); }
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            }
            @keyframes fadeOut {
                from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                to { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            }
        `;
        document.head.appendChild(notifStyle);

        // Inline Game Functionality with Fullscreen Option
        document.addEventListener('DOMContentLoaded', function() {
            const startGameBtn = document.getElementById('startGameBtn');
            const gameFrame = document.getElementById('gameFrame');
            const gameStartScreen = document.getElementById('gameStartScreen');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const fullscreenText = document.getElementById('fullscreenText');
            const gameWrapper = document.getElementById('gameWrapper');
            
            if (startGameBtn && gameFrame && gameStartScreen) {
                startGameBtn.addEventListener('click', function() {
                    console.log('Start game clicked');
                    
                    // Check if on mobile
                    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                    
                    // On mobile, navigate directly to mobile-optimized game page
                    if (isMobile) {
                        console.log('Mobile device - navigating to mobile game');
                        // Check WebGL support
                        const canvas = document.createElement('canvas');
                        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                        
                        if (!gl) {
                            console.log('WebGL not supported - using 2D fallback');
                            window.location.href = 'game-mobile.html';
                        } else {
                            console.log('WebGL supported - trying 3D game');
                            window.location.href = 'game.html';
                        }
                        return;
                    }
                    
                    // Desktop: use iframe as before
                    // Hide start screen  
                    gameStartScreen.style.display = 'none';
                    
                    // Set a loading timeout
                    let loadTimeout;
                    
                    // Show and load game
                    gameFrame.style.display = 'block';
                    gameFrame.src = 'game.html';
                    
                    // Set loading timeout for desktop
                    loadTimeout = setTimeout(() => {
                        console.error('Game loading timeout');
                        gameStartScreen.style.display = 'flex';
                        gameStartScreen.innerHTML = '<div style="text-align: center; padding: 20px;"><p style="color: #ff5252; margin-bottom: 20px;">Game loading timeout.</p><button class="btn" onclick="location.reload()">Try Again</button></div>';
                    }, 10000);
                    
                    // Show fullscreen button only on desktop
                    if (fullscreenBtn && !isMobile) {
                        fullscreenBtn.style.display = 'inline-block';
                    }
                    
                    // Scroll to game
                    gameWrapper.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Add error handler
                    gameFrame.onerror = function(e) {
                        clearTimeout(loadTimeout);
                        console.error('Game iframe error:', e);
                        gameStartScreen.style.display = 'flex';
                        gameStartScreen.innerHTML = '<div style="text-align: center; padding: 20px;"><p style="color: #ff5252; margin-bottom: 20px;">Error loading game.</p><button class="btn" onclick="location.reload()">Try Again</button></div>';
                    };
                    
                    // Handle iframe load events
                    gameFrame.onload = function() {
                        clearTimeout(loadTimeout);
                        console.log('Game iframe loaded successfully');
                        
                        // Check if iframe content is accessible
                        try {
                            const iframeDoc = gameFrame.contentDocument || gameFrame.contentWindow.document;
                            console.log('Iframe document accessible:', !!iframeDoc);
                        } catch (e) {
                            console.log('Cannot access iframe content (cross-origin):', e.message);
                        }
                        
                        // Don't try to focus on mobile
                        if (!isMobile) {
                            gameFrame.focus();
                        }
                        
                        // Add message about clicking to focus
                        const clickToFocus = document.getElementById('clickToFocus');
                        
                        // Show focus message when iframe loses focus
                        const checkFocus = function() {
                            const isFocused = document.activeElement === gameFrame;
                            if (!isFocused && gameFrame.style.display === 'block') {
                                clickToFocus.style.display = 'block';
                                // Add fade-in effect
                                clickToFocus.style.opacity = '0';
                                setTimeout(() => {
                                    clickToFocus.style.transition = 'opacity 0.3s ease';
                                    clickToFocus.style.opacity = '1';
                                }, 10);
                            } else {
                                clickToFocus.style.display = 'none';
                            }
                        };
                        
                        // Check focus periodically
                        setInterval(checkFocus, 500);
                        
                        // Add click handler to game wrapper to focus iframe
                        gameWrapper.addEventListener('click', function() {
                            gameFrame.focus();
                            clickToFocus.style.display = 'none';
                        });
                    };
                    
                    // Prevent page scroll when game is active
                    const preventScroll = function(e) {
                        if (document.activeElement === gameFrame || 
                            (gameFrame.contentWindow && document.activeElement === gameFrame.contentWindow.document.body)) {
                            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' ', 'Space'].includes(e.key)) {
                                e.preventDefault();
                            }
                        }
                    };
                    
                    window.addEventListener('keydown', preventScroll);
                    
                    // Store the handler for cleanup
                    gameFrame.dataset.scrollHandler = 'true';
                    window.preventGameScroll = preventScroll;
                });
            }
            
            // Fullscreen functionality
            if (fullscreenBtn && gameWrapper) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        gameWrapper.requestFullscreen().then(() => {
                            fullscreenText.textContent = '✕ EXIT FULLSCREEN';
                            gameWrapper.style.height = '100vh';
                        }).catch(err => {
                            console.error('Error attempting to enable fullscreen:', err);
                        });
                    } else {
                        document.exitFullscreen().then(() => {
                            fullscreenText.textContent = '⛶ FULLSCREEN';
                            gameWrapper.style.height = '500px';
                        });
                    }
                });
                
                // Listen for fullscreen changes
                document.addEventListener('fullscreenchange', function() {
                    if (!document.fullscreenElement) {
                        fullscreenText.textContent = '⛶ FULLSCREEN';
                        gameWrapper.style.height = '500px';
                    }
                });
                
                // Exit fullscreen on ESC
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && document.fullscreenElement) {
                        document.exitFullscreen();
                    }
                });
            }
            
            // Purchase Form Handling
            const purchaseForm = document.getElementById('purchaseForm');
            const decreaseBtn = document.getElementById('decreaseBatch');
            const increaseBtn = document.getElementById('increaseBatch');
            const batchCountEl = document.getElementById('batchCount');
            const totalBTCEl = document.getElementById('totalBTC');
            const totalSatsEl = document.getElementById('totalSats');
            const tokenAmountEl = document.getElementById('tokenAmount');
            const maxBatchesEl = document.getElementById('maxBatches');
            const closeModalBtn = document.getElementById('closeModal');
            const scanQRBtn = document.getElementById('scanQRBtn');
            
            // QR Scanner functionality
            let html5QrCode = null;
            let isScanning = false;
            
            if (scanQRBtn) {
                scanQRBtn.addEventListener('click', async () => {
                    const modal = document.getElementById('qrScannerModal');
                    modal.style.display = 'flex';
                    
                    // Reset to initial state
                    document.getElementById('cameraPermissionDiv').style.display = 'block';
                    document.getElementById('qrReaderDiv').style.display = 'none';
                    document.getElementById('scanSuccessDiv').style.display = 'none';
                    
                    // Check if we can use camera
                    try {
                        const devices = await Html5Qrcode.getCameras();
                        if (!devices || devices.length === 0) {
                            throw new Error('No cameras found on this device');
                        }
                        
                        // Update permission button text based on camera availability
                        document.getElementById('startScannerBtn').textContent = 
                            devices.length > 1 ? 'Enable Camera & Scan' : 'Start Scanner';
                    } catch (err) {
                        console.log('Camera detection:', err);
                        // Still allow user to try - might just be a permission issue
                    }
                });
            }
            
            // Start Scanner Button
            const startScannerBtn = document.getElementById('startScannerBtn');
            if (startScannerBtn) {
                startScannerBtn.addEventListener('click', async () => {
                    try {
                        // Check if Html5Qrcode is available
                        if (typeof Html5QrcodeScanner === 'undefined') {
                            throw new Error('QR scanner library not loaded. Please check your internet connection.');
                        }
                        
                        console.log('QR Scanner library loaded successfully');
                        
                        // Hide permission div, show scanner
                        document.getElementById('cameraPermissionDiv').style.display = 'none';
                        document.getElementById('qrReaderDiv').style.display = 'block';
                        
                        // Clear the container first
                        document.getElementById('qrReaderDiv').innerHTML = '';
                        
                        // Success callback
                        const onScanSuccess = (decodedText, decodedResult) => {
                            console.log('QR Code detected:', decodedText);
                            
                            // Check if it's a valid RGB invoice
                            if (decodedText.startsWith('rgb:') || decodedText.includes('utxob:')) {
                                // Update UI
                                document.getElementById('qrReaderDiv').style.display = 'none';
                                document.getElementById('scanSuccessDiv').style.display = 'block';
                                document.getElementById('scannedInvoice').textContent = decodedText;
                                
                                // Stop the scanner
                                if (html5QrCode) {
                                    html5QrCode.clear();
                                }
                                
                                // Auto-fill the form and close modal after 2 seconds
                                setTimeout(() => {
                                    document.getElementById('rgbInvoice').value = decodedText;
                                    document.getElementById('qrScannerModal').style.display = 'none';
                                    showNotification('RGB invoice scanned successfully!', 'success');
                                }, 2000);
                            } else {
                                showNotification('Invalid QR code. Please scan an RGB invoice.', 'error');
                            }
                        };
                        
                        const onScanFailure = (error) => {
                            // We ignore scan failures (happens when no QR code in view)
                            // Only log if it's not a "no QR code" error
                            if (!error.includes('NotFoundException')) {
                                console.warn('QR scan error:', error);
                            }
                        };
                        
                        // Create and render the scanner
                        html5QrCode = new Html5QrcodeScanner(
                            "qrReaderDiv",
                            { 
                                fps: 10,
                                qrbox: { width: 250, height: 250 },
                                rememberLastUsedCamera: true,
                                showTorchButtonIfSupported: true
                            },
                            false
                        );
                        
                        html5QrCode.render(onScanSuccess, onScanFailure);
                        
                    } catch (error) {
                        console.error('Scanner error:', error);
                        isScanning = false;
                        
                        // Determine error type and show appropriate message
                        let errorTitle = 'Camera Not Available';
                        let errorMessage = 'Unable to access camera.';
                        let errorDetails = [];
                        
                        if (error.name === 'NotAllowedError' || error.message.includes('Permission denied')) {
                            errorTitle = 'Camera Permission Denied';
                            errorMessage = 'Please allow camera access to scan QR codes.';
                            errorDetails = [
                                'Click the camera icon in your browser\'s address bar',
                                'Select "Allow" for camera permissions',
                                'Then try scanning again'
                            ];
                        } else if (error.name === 'NotFoundError' || error.message.includes('No cameras')) {
                            errorTitle = 'No Camera Found';
                            errorMessage = 'No camera detected on this device.';
                            errorDetails = [
                                'Make sure your device has a working camera',
                                'Check if camera is being used by another app',
                                'Try refreshing the page'
                            ];
                        } else if (error.name === 'NotReadableError') {
                            errorTitle = 'Camera In Use';
                            errorMessage = 'Camera is being used by another application.';
                            errorDetails = [
                                'Close other apps using the camera',
                                'Try refreshing this page',
                                'Restart your browser if needed'
                            ];
                        } else if (location.protocol === 'file:') {
                            errorTitle = 'Local File Access';
                            errorMessage = 'Camera access not allowed from local files.';
                            errorDetails = [
                                'Upload the site to a web server',
                                'Use a local development server',
                                'Access via http://localhost instead'
                            ];
                        } else {
                            errorDetails = [
                                'Ensure you\'re using a supported browser',
                                'Check camera permissions in browser settings',
                                'Make sure site is accessed via HTTPS',
                                'Try refreshing the page'
                            ];
                        }
                        
                        // Show error in the modal
                        document.getElementById('cameraPermissionDiv').innerHTML = `
                            <div style="padding: 20px;">
                                <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: #ff5252; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="#fff">
                                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                    </svg>
                                </div>
                                <h3 style="color: #ff5252; margin-bottom: 15px;">${errorTitle}</h3>
                                <p style="color: rgba(255,255,255,0.8); margin-bottom: 15px; font-size: 0.9rem;">
                                    ${errorMessage}
                                </p>
                                <ul style="text-align: left; color: rgba(255,255,255,0.7); font-size: 0.85rem; max-width: 300px; margin: 0 auto 20px;">
                                    ${errorDetails.map(detail => `<li style="margin-bottom: 5px;">${detail}</li>`).join('')}
                                </ul>
                                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                    <button onclick="location.reload()" 
                                            style="background: transparent; color: var(--yellow); border: 1px solid var(--yellow); padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                                        Refresh Page
                                    </button>
                                    <button onclick="document.getElementById('qrScannerModal').style.display='none'" 
                                            style="background: var(--yellow); color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                                        Enter Manually
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                });
            }
            
            // Manual input button
            const manualInputBtn = document.getElementById('manualInputBtn');
            if (manualInputBtn) {
                manualInputBtn.addEventListener('click', () => {
                    if (html5QrCode) {
                        html5QrCode.clear();
                        html5QrCode = null;
                    }
                    document.getElementById('qrScannerModal').style.display = 'none';
                });
            }
            
            // Close QR scanner modal
            const closeQRScanner = document.getElementById('closeQRScanner');
            if (closeQRScanner) {
                closeQRScanner.addEventListener('click', () => {
                    if (html5QrCode) {
                        html5QrCode.clear();
                        html5QrCode = null;
                    }
                    document.getElementById('qrScannerModal').style.display = 'none';
                });
            }
            
            // Close on outside click
            document.getElementById('qrScannerModal').addEventListener('click', (e) => {
                if (e.target.id === 'qrScannerModal') {
                    if (html5QrCode) {
                        html5QrCode.clear();
                        html5QrCode = null;
                    }
                    document.getElementById('qrScannerModal').style.display = 'none';
                }
            });
            
            // Upload QR Image functionality
            const uploadQRBtn = document.getElementById('uploadQRBtn');
            const qrFileInput = document.getElementById('qrFileInput');
            
            if (uploadQRBtn && qrFileInput) {
                uploadQRBtn.addEventListener('click', () => {
                    qrFileInput.click();
                });
                
                qrFileInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        try {
                            // Show loading state
                            document.getElementById('cameraPermissionDiv').innerHTML = `
                                <div style="padding: 40px;">
                                    <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: var(--yellow); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <svg width="40" height="40" viewBox="0 0 24 24" fill="#000" style="animation: spin 1s linear infinite;">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                        </svg>
                                    </div>
                                    <h3 style="color: var(--yellow); margin-bottom: 15px;">Scanning QR Code...</h3>
                                    <p style="color: rgba(255,255,255,0.8);">
                                        Processing uploaded image
                                    </p>
                                </div>
                            `;
                            
                            // Initialize scanner for file
                            const html5QrCodeFile = new Html5Qrcode("qrReaderDiv");
                            
                            // Scan the file
                            const decodedText = await html5QrCodeFile.scanFile(file, true);
                            
                            // Check if it's a valid RGB invoice
                            if (decodedText.startsWith('rgb:') || decodedText.includes('utxob:')) {
                                // Success!
                                document.getElementById('cameraPermissionDiv').style.display = 'none';
                                document.getElementById('scanSuccessDiv').style.display = 'block';
                                document.getElementById('scannedInvoice').textContent = decodedText;
                                
                                // Auto-fill the form and close modal after 2 seconds
                                setTimeout(() => {
                                    document.getElementById('rgbInvoice').value = decodedText;
                                    document.getElementById('qrScannerModal').style.display = 'none';
                                    showNotification('RGB invoice scanned successfully!', 'success');
                                }, 2000);
                            } else {
                                throw new Error('Invalid QR code - not an RGB invoice');
                            }
                            
                        } catch (error) {
                            console.error('File scan error:', error);
                            
                            // Show error
                            document.getElementById('cameraPermissionDiv').innerHTML = `
                                <div style="padding: 20px;">
                                    <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: #ff5252; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <svg width="40" height="40" viewBox="0 0 24 24" fill="#fff">
                                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                        </svg>
                                    </div>
                                    <h3 style="color: #ff5252; margin-bottom: 15px;">Scan Failed</h3>
                                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px;">
                                        ${error.message.includes('Invalid QR') 
                                            ? 'The QR code is not a valid RGB invoice' 
                                            : 'Could not read QR code from image'}
                                    </p>
                                    <div style="display: flex; gap: 10px; justify-content: center;">
                                        <button onclick="document.getElementById('qrFileInput').click()" 
                                                style="background: transparent; color: var(--yellow); border: 1px solid var(--yellow); padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                                            Try Another Image
                                        </button>
                                        <button onclick="document.getElementById('qrScannerModal').style.display='none'" 
                                                style="background: var(--yellow); color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;">
                                            Enter Manually
                                        </button>
                                    </div>
                                </div>
                            `;
                        }
                        
                        // Reset file input
                        qrFileInput.value = '';
                    }
                });
            }
            
            // Add spinning animation
            const styleEl = document.createElement('style');
            styleEl.textContent = `
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(styleEl);
            
            // Constants
            const PRICE_PER_BATCH_BTC = 0.00002;
            const TOKENS_PER_BATCH = 700;
            const PRICE_PER_BATCH_SATS = 2000;
            
            // State
            let currentBatches = 1;
            let maxBatches = 5; // Default, will be updated based on game tier
            let isMintClosed = false; // Track if mint is closed
            
            // Check for unlocked tier from game
            const urlParams = new URLSearchParams(window.location.search);
            const unlockedTier = urlParams.get('tier') || localStorage.getItem('unlockedTier');
            
            if (unlockedTier) {
                switch(unlockedTier.toLowerCase()) {
                    case 'bronze':
                        maxBatches = 5;
                        break;
                    case 'silver':
                        maxBatches = 8;
                        break;
                    case 'gold':
                        maxBatches = 10;
                        break;
                    default:
                        maxBatches = 5;
                }
                maxBatchesEl.textContent = maxBatches;
                
                // Highlight the unlocked tier
                const tierMap = { bronze: 'tier1', silver: 'tier2', gold: 'tier3' };
                const tierCard = document.getElementById(tierMap[unlockedTier.toLowerCase()]);
                if (tierCard) {
                    tierCard.classList.add('unlocked');
                }
                
                // Show tier unlock notification if coming from game
                if (urlParams.get('tier')) {
                    // Scroll to purchase section
                    setTimeout(() => {
                        document.getElementById('purchase').scrollIntoView({ behavior: 'smooth' });
                        
                        // Show special notification
                        const notification = document.createElement('div');
                        notification.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: #000;
                            border: 3px solid var(--yellow);
                            padding: 40px;
                            border-radius: 20px;
                            z-index: 9999;
                            text-align: center;
                            max-width: 500px;
                            animation: fadeIn 0.5s ease;
                        `;
                        notification.innerHTML = `
                            <h2 style="color: var(--yellow); font-size: 2rem; margin-bottom: 20px; text-transform: uppercase;">
                                ${unlockedTier.toUpperCase()} TIER UNLOCKED!
                            </h2>
                            <p style="font-size: 1.2rem; color: #fff; margin-bottom: 30px;">
                                Congratulations! You can now purchase up to <span style="color: var(--yellow); font-weight: bold;">${maxBatches} batches</span> of LIGHTCAT tokens.
                            </p>
                            <button onclick="this.parentElement.remove()" style="background: var(--yellow); color: #000; border: none; padding: 15px 40px; font-size: 1rem; font-weight: bold; border-radius: 50px; cursor: pointer; text-transform: uppercase;">
                                Start Purchasing
                            </button>
                        `;
                        document.body.appendChild(notification);
                        
                        // Auto-remove after 5 seconds
                        setTimeout(() => {
                            if (notification.parentElement) {
                                notification.style.animation = 'fadeOut 0.5s ease';
                                setTimeout(() => notification.remove(), 500);
                            }
                        }, 5000);
                    }, 500);
                    
                    // Clear URL parameter
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }
            
            // Update display
            function updateBatchDisplay() {
                batchCountEl.textContent = currentBatches;
                const totalBTC = (currentBatches * PRICE_PER_BATCH_BTC).toFixed(8);
                const totalSats = currentBatches * PRICE_PER_BATCH_SATS;
                const totalTokens = currentBatches * TOKENS_PER_BATCH;
                
                totalBTCEl.textContent = totalBTC + ' BTC';
                totalSatsEl.textContent = totalSats.toLocaleString();
                tokenAmountEl.textContent = totalTokens.toLocaleString();
                
                // Update button states
                decreaseBtn.disabled = currentBatches <= 1;
                increaseBtn.disabled = currentBatches >= maxBatches;
            }
            
            // Batch controls
            decreaseBtn.addEventListener('click', () => {
                if (currentBatches > 1) {
                    currentBatches--;
                    updateBatchDisplay();
                }
            });
            
            increaseBtn.addEventListener('click', () => {
                if (currentBatches < maxBatches) {
                    currentBatches++;
                    updateBatchDisplay();
                }
            });
            
            // Form submission
            purchaseForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Check if mint is closed
                if (isMintClosed) {
                    showNotification('MINT IS CLOSED - No new purchases allowed', 'error');
                    return;
                }
                
                const rgbInvoice = document.getElementById('rgbInvoice').value.trim();
                const email = document.getElementById('emailAddress').value.trim();
                
                // Basic validation
                if (!rgbInvoice) {
                    showNotification('Please enter your RGB invoice');
                    return;
                }
                
                // Validate RGB invoice format (basic check)
                if (!rgbInvoice.startsWith('rgb:') && !rgbInvoice.includes('utxob:')) {
                    showNotification('Please enter a valid RGB invoice');
                    return;
                }
                
                // Disable submit button
                const submitBtn = purchaseForm.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.textContent = 'CREATING LIGHTNING INVOICE...';
                
                try {
                    // Create invoice via API
                    const response = await fetch('/api/rgb/invoice', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            rgbInvoice: rgbInvoice,
                            email: email,
                            batchCount: currentBatches
                        })
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Failed to create invoice');
                    }
                    
                    const result = await response.json();
                    const invoice = result.invoice;
                    
                    // Show payment modal
                    showPaymentModal(invoice);
                    
                    // Store invoice for reference
                    localStorage.setItem('currentInvoice', JSON.stringify(invoice));
                    
                    // Start payment verification polling
                    startPaymentVerification(invoice.id);
                    
                } catch (error) {
                    console.error('Error creating invoice:', error);
                    showNotification('Error creating invoice. Please try again.');
                } finally {
                    // Re-enable submit button
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'CREATE LIGHTNING INVOICE';
                }
            });
            
            // Payment verification
            function startPaymentVerification(invoiceId) {
                let checkCount = 0;
                const maxChecks = 360; // 30 minutes at 5 second intervals
                
                const verificationInterval = setInterval(async () => {
                    checkCount++;
                    
                    try {
                        const response = await fetch(`/api/rgb/invoice/${invoiceId}/status`);
                        
                        if (!response.ok) {
                            throw new Error('Verification failed');
                        }
                        
                        const result = await response.json();
                        const statusEl = document.getElementById('paymentStatus');
                        const consignmentDiv = document.getElementById('consignmentReady');
                        
                        if (result.status === 'paid' && result.paid) {
                            clearInterval(verificationInterval);
                            
                            if (statusEl) {
                                statusEl.innerHTML = '<span style="color: #4CAF50;">✓ Payment confirmed!</span>';
                            }
                            
                            // Check if consignment is ready
                            if (result.consignment && result.consignment.ready) {
                                consignmentDiv.style.display = 'block';
                                window.currentInvoiceId = invoiceId;
                            }
                            
                            showNotification('Payment confirmed! Your consignment is being prepared.');
                            
                            // Update stats
                            updateMintStats();
                            
                        } else if (result.status === 'expired') {
                            clearInterval(verificationInterval);
                            if (statusEl) {
                                statusEl.innerHTML = '<span style="color: #ff5252;">Invoice expired. Please create a new one.</span>';
                            }
                        } else {
                            // Still pending
                            if (statusEl) {
                                statusEl.textContent = `Waiting for payment... (${Math.floor(checkCount * 5 / 60)}m ${(checkCount * 5) % 60}s)`;
                            }
                        }
                        
                    } catch (error) {
                        console.error('Verification error:', error);
                    }
                    
                    if (checkCount >= maxChecks) {
                        clearInterval(verificationInterval);
                        const statusEl = document.getElementById('paymentStatus');
                        if (statusEl) {
                            statusEl.innerHTML = '<span style="color: #ff5252;">Payment verification timeout.</span>';
                        }
                    }
                }, 5000);
                
                // Store interval ID for cleanup
                window.currentVerificationInterval = verificationInterval;
            }
            
            // Download consignment
            function downloadConsignment() {
                if (window.currentInvoiceId) {
                    window.location.href = `/api/rgb/download/${window.currentInvoiceId}`;
                }
            }
            
            // Copy Lightning invoice
            function copyInvoice() {
                const invoiceEl = document.getElementById('lightningInvoice');
                if (invoiceEl && invoiceEl.textContent !== 'Loading...') {
                    navigator.clipboard.writeText(invoiceEl.textContent);
                    showNotification('Lightning invoice copied!');
                }
            }
            
            // Modal close
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', () => {
                    document.getElementById('paymentModal').style.display = 'none';
                    // Clear verification interval if exists
                    if (window.currentVerificationInterval) {
                        clearInterval(window.currentVerificationInterval);
                    }
                });
            }
            
            // Close modal on outside click
            document.getElementById('paymentModal').addEventListener('click', (e) => {
                if (e.target.id === 'paymentModal') {
                    document.getElementById('paymentModal').style.display = 'none';
                    if (window.currentVerificationInterval) {
                        clearInterval(window.currentVerificationInterval);
                    }
                }
            });
            
            // Initialize display
            updateBatchDisplay();
            
            // Update mint stats from API
            async function updateMintStats() {
                try {
                    const response = await fetch('/api/rgb/stats');
                    if (!response.ok) {
                        throw new Error('Failed to fetch stats');
                    }
                    
                    const result = await response.json();
                    const stats = result.stats;
                    
                    // Constants - showing full 30k with team/partner allocation
                    const TOTAL_SUPPLY_BATCHES = 30000; // Full 21M tokens / 700
                    const TEAM_BATCHES = 1500; // 5% of 30k
                    const PARTNER_BATCHES = 600; // 2% of 30k
                    const PRE_ALLOCATED = TEAM_BATCHES + PARTNER_BATCHES; // 2100 batches (7%)
                    const PUBLIC_BATCHES = 27900;
                    
                    // Get actual public sales
                    const publicSoldBatches = stats.totalBatchesSold || 0;
                    const totalAllocated = PRE_ALLOCATED + publicSoldBatches;
                    const publicRemaining = PUBLIC_BATCHES - publicSoldBatches;
                    const totalTokensAllocated = totalAllocated * 700;
                    const uniqueBuyers = stats.uniqueBuyers || 0;
                    
                    // Calculate percentage of TOTAL supply (creates FOMO)
                    const percentAllocated = ((totalAllocated / TOTAL_SUPPLY_BATCHES) * 100).toFixed(2);
                    
                    // Show warning if almost sold out
                    if (publicRemaining > 0 && publicRemaining <= 1000) {
                        // Create warning banner if doesn't exist
                        let warningBanner = document.getElementById('soldOutWarning');
                        if (!warningBanner) {
                            warningBanner = document.createElement('div');
                            warningBanner.id = 'soldOutWarning';
                            warningBanner.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #FF5252; color: white; padding: 15px; text-align: center; z-index: 9999; font-weight: bold; font-size: 1.1rem;';
                            warningBanner.textContent = `⚠️ ONLY ${publicRemaining} BATCHES REMAINING - MINT CLOSING SOON ⚠️`;
                            document.body.prepend(warningBanner);
                        } else {
                            warningBanner.textContent = `⚠️ ONLY ${publicRemaining} BATCHES REMAINING - MINT CLOSING SOON ⚠️`;
                        }
                    }
                    
                    // Check if sold out
                    if (publicRemaining <= 0) {
                        isMintClosed = true;
                        document.getElementById('progressText').textContent = '100% SOLD OUT';
                        document.getElementById('progressBar').style.width = '100%';
                        document.getElementById('progressBar').style.background = '#FF5252'; // Red for sold out
                        
                        // Disable purchase form
                        const purchaseForm = document.getElementById('purchaseForm');
                        if (purchaseForm) {
                            purchaseForm.style.opacity = '0.5';
                            purchaseForm.style.pointerEvents = 'none';
                            const submitBtn = purchaseForm.querySelector('button[type="submit"]');
                            if (submitBtn) {
                                submitBtn.textContent = 'SOLD OUT';
                                submitBtn.disabled = true;
                            }
                        }
                    } else {
                        // Update DOM with clean numbers (including pre-allocated)
                        document.getElementById('progressText').textContent = percentAllocated + '% SOLD';
                        document.getElementById('progressBar').style.width = percentAllocated + '%';
                        document.getElementById('progressBar').style.background = 'var(--yellow)';
                    }
                    
                    document.getElementById('soldBatches').textContent = totalAllocated.toLocaleString();
                    document.getElementById('remainingBatches').textContent = publicRemaining.toLocaleString();
                    document.getElementById('totalTokens').textContent = totalTokensAllocated.toLocaleString();
                    document.getElementById('uniqueBuyers').textContent = uniqueBuyers.toLocaleString();
                    
                } catch (error) {
                    console.error('Error fetching stats:', error);
                    // Keep current values on error
                }
            }
            
            // Call on page load
            updateMintStats();
            
            // Update stats periodically to keep data live
            setInterval(updateMintStats, 5000); // Update every 5 seconds for real-time data
        });
    </script>
</body>
</html>